import type { Metadata } from "next";
import { Inter } from "next/font/google";
import { redirect } from "next/navigation"; // ğŸ’¡ ë¦¬ë””ë ‰ì…˜ì„ ìœ„í•œ Next.js ì„œë²„ ìœ í‹¸ë¦¬í‹°
import { headers } from "next/headers"; // ğŸ’¡ í˜„ì¬ ê²½ë¡œë¥¼ í™•ì¸í•˜ê¸° ìœ„í•œ ì„œë²„ ìœ í‹¸ë¦¬í‹°
import { handleLoginChk } from "@/app/serveraction/loginchk/loginchkaction";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

// 1. RootLayout í•¨ìˆ˜ë¥¼ asyncë¡œ ì„ ì–¸í•©ë‹ˆë‹¤.
export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  // 2. í˜„ì¬ ê²½ë¡œë¥¼ ì„œë²„ì—ì„œ í™•ì¸í•©ë‹ˆë‹¤.
  const headersList = headers();
  // 'x-pathname' í—¤ë”ëŠ” ìš”ì²­ëœ ê²½ë¡œë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
  const pathname = headersList.get("x-pathname"); 
  // ë¦¬ë””ë ‰ì…˜ ëŒ€ìƒ ê²½ë¡œë¥¼ ì •ì˜í•©ë‹ˆë‹¤. (ì‹¤ì œ ë¡œê·¸ì¸ í˜ì´ì§€ ê²½ë¡œë¡œ ë³€ê²½)
  const loginPath = "/auth/login"; 
  
  // 3. ì„œë²„ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
  // handleLoginChkëŠ” ì‚¬ìš©ì ID(ë¬¸ìì—´) ë˜ëŠ” nullì„ ë°˜í™˜í•©ë‹ˆë‹¤.
  const userId = await handleLoginChk(); 
  
  // 4. ë¡œê·¸ì¸ ì²´í¬ ë° ë¦¬ë””ë ‰ì…˜ ë¡œì§ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
  // userIdê°€ nullì´ê³  (ë¡œê·¸ì•„ì›ƒ ìƒíƒœ) í˜„ì¬ ê²½ë¡œê°€ ë¡œê·¸ì¸ í˜ì´ì§€ê°€ ì•„ë‹ˆë¼ë©´ ë¦¬ë””ë ‰ì…˜!
  if (!userId && pathname !== loginPath) {
    // redirect()ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ Next.jsì—ê²Œ ë¦¬ë””ë ‰ì…˜ ì‘ë‹µì„ ë³´ë‚´ë„ë¡ ì§€ì‹œí•©ë‹ˆë‹¤.
    redirect(loginPath);
  }

  return (
    <html lang="en">
      <body className={inter.className}>{children}</body>
    </html>
  );
}